

// Advanced hardening.

// We can do better.

// This is what I generally use for my primary profile & browsing needs. 

// Some of these will be configured as "pref", which allows overriding if needed, but resets on next launch.

// 001 NETWORKING

// Require safe renegotiations - Disables RFC 5746

pref("security.ssl.require_safe_negotiation", true);

// Hard-fail OCSP per session

defaultPref("security.OCSP.require", false); // [DEFAULT]
pref("security.OCSP.require", true);

// 002 FINGERPRINTING PROTECTION

/// Enable RFP (resistFingerprinting)
// https://github.com/arkenfox/user.js/blob/master/user.js#L745

pref("privacy.resistFingerprinting", true);
pref("privacy.resistFingerprinting.letterboxing", true);

/// Disable FPP Overrides/WebCompat

defaultPref("privacy.fingerprintingProtection.remoteOverrides.enabled", false);

/// Disable WebGL
// https://blog.browserscan.net/docs/webgl-fingerprinting
// https://security.stackexchange.com/questions/13799/is-webgl-a-security-concern

pref("webgl.disabled", true);

/// 003 WEBRTC

// Never leak IP address - This *will* break WebRTC

lockPref("media.peerconnection.ice.default_address_only", true);
lockPref("media.peerconnection.ice.no_host", true);

// 004 MISC. PRIVACY

/// Enforce blocking Geolocation, as well as Microphone & Camera

pref("permissions.default.camera", 2);
pref("permissions.default.geo", 2);
pref("permissions.default.microphone", 2);

/// Disable ETP WebCompat & Heuristics

pref("privacy.antitracking.enableWebcompat", false);
pref("privacy.restrict3rdpartystorage.heuristic.opened_window_after_interaction", false);
pref("privacy.restrict3rdpartystorage.heuristic.recently_visited", false);
pref("privacy.restrict3rdpartystorage.heuristic.redirect", false);
pref("privacy.restrict3rdpartystorage.heuristic.window_open", false);

/// Only send cross-origin referers if hosts match

defaultPref("network.http.referer.XOriginPolicy", 2);

/// Always sanitize data

lockPref("privacy.clearHistory.historyFormDataAndDownloads", true);
lockPref("privacy.clearSiteData.historyFormDataAndDownloads", true);
lockPref("privacy.clearOnShutdown.cookies", true);
lockPref("privacy.clearOnShutdown.downloads", true);
lockPref("privacy.clearOnShutdown.history", true);
lockPref("privacy.clearOnShutdown.offlineApps", true);
lockPref("privacy.clearOnShutdown_v2.cookiesAndStorage", true);
lockPref("privacy.clearOnShutdown_v2.historyFormDataAndDownloads", true);

/// Never sync Browser History

lockPref("services.sync.engine.history", false);

// 005 PASSWORDS & AUTHENTICATION

/// Kill Browser Password Manager

lockPref("browser.contentblocking.report.endpoint_url", "");
lockPref("browser.contentblocking.report.lockwise.enabled", false);
lockPref("browser.contentblocking.report.lockwise.how_it_works.url", "");
lockPref("browser.contentblocking.report.mobile-android.url", "");
lockPref("browser.contentblocking.report.mobile-ios.url", "");
lockPref("browser.contentblocking.report.monitor.enabled", false);
lockPref("browser.contentblocking.report.monitor.home_page_url", "");
lockPref("browser.contentblocking.report.monitor.how_it_works.url", "");
lockPref("browser.contentblocking.report.monitor.preferences_url", "");
lockPref("browser.contentblocking.report.monitor.sign_in_url", "");
lockPref("browser.contentblocking.report.monitor.url", "");
lockPref("extensions.formautofill.addresses.enabled", false);
lockPref("extensions.formautofill.creditCards.enabled", false);
lockPref("pref.privacy.disable_button.view_passwords", true);
lockPref("privacy.cpd.passwords", true);
lockPref("signon.generation.enabled", false);
lockPref("signon.rememberSignons", false);
lockPref("signon.recipes.remoteRecipes.enabled", false);
lockPref("services.passwordSavingEnabled", false);
lockPref("services.sync.engine.passwords", false);
lockPref("signon.management.page.breach-alerts.enabled", false);
lockPref("signon.management.page.breachAlertUrl", "");
lockPref("signon.management.page.vulnerable-passwords.enabled", false);

// 006 ATTACK SURFACE REDUCTION

/// Disable WebAssembly
// https://spectrum.ieee.org/more-worries-over-the-security-of-web-assembly

defaultPref("javascript.options.wasm", false);

// 007 MISC. SECURITY

/// Prevent sending HTTP requests to websites that do not respond quickly to check if they support HTTPS

defaultPref("dom.security.https_only_mode_send_http_background_request", false);

// 008 MISC.

/// Prevent sites from automatically refreshing

defaultPref("accessibility.blockautorefresh", true);
defaultPref("browser.meta_refresh_when_inactive.disabled", true);

/// Stricter Autoplay Blocking

defaultPref("media.autoplay.blocking_policy", 2);